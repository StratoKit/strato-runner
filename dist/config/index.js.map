{"version":3,"sources":["../../src/config/index.js"],"names":["confippet","require","mergeWith","NODE_ENV","process","env","defaults","err","code","config","store","_$","dirs","i","dir","push","length","NODE_CONFIG_DIR","console","log","compose","failMissing","warnMissing"],"mappings":";;;;;;;AAAA;AACA;AACA;AAEA,MAAMA,SAAS,GAAGC,OAAO,CAAC,qBAAD,CAAzB,C,CAEA;;;AACA,MAAMC,SAAS,GAAGD,OAAO,CAAC,kBAAD,CAAzB;;AAEA,MAAM;AAACE,EAAAA;AAAD,IAAaC,OAAO,CAACC,GAAR,IAAe,aAAlC;;AAEAJ,OAAO,CAAC,4BAAD,CAAP;;AACA,MAAMK,QAAQ,GAAGL,OAAO,CAAC,oBAAD,CAAxB;;AACA,IAAI;AACHC,EAAAA,SAAS,CAACI,QAAD,EAAWL,OAAO,CAAE,cAAaE,QAAS,EAAxB,CAAlB,CAAT;AACA,CAFD,CAEE,OAAOI,GAAP,EAAY;AACb,MAAIA,GAAG,CAACC,IAAJ,KAAa,kBAAjB,EAAqC;AACpC,UAAMD,GAAN;AACA;AACD,C,CAED;;;AACA,MAAME,MAAM,GAAGT,SAAS,CAACU,KAAV,EAAf;;AACAD,MAAM,CAACE,EAAP,CAAUL,QAAV,CAAmBA,QAAnB,E,CAEA;;;AACA,MAAMM,IAAI,GAAG,EAAb;;AACA,KAAK,IAAIC,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAG,EAAtB,EAA2BA,GAAG,GAAGV,OAAO,CAACC,GAAR,CAAa,mBAAkBQ,CAAE,EAAjC,CAAjC,EAAuE,EAAEA,CAAzE,EAA4E;AAC3ED,EAAAA,IAAI,CAACG,IAAL,CAAUD,GAAV;AACA;;AACD,IAAIF,IAAI,CAACI,MAAL,GAAc,CAAd,IAAmBZ,OAAO,CAACC,GAAR,CAAYY,eAAnC,EAAoD;AACnDL,EAAAA,IAAI,CAACG,IAAL,CAAUX,OAAO,CAACC,GAAR,CAAYY,eAAtB;AACA;;AACD,IAAIL,IAAI,CAACI,MAAL,GAAc,CAAlB,EAAqB;AACpB;AACAE,EAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ,EAA2BP,IAA3B;AACA,C,CAED;AACA;;;AACAH,MAAM,CAACE,EAAP,CAAUS,OAAV,CAAkB;AACjBR,EAAAA,IAAI,EAAEA,IAAI,CAACI,MAAL,GAAc,CAAd,IAAmBJ,IADR;AAEjBE,EAAAA,GAAG,EAAEV,OAAO,CAACC,GAAR,CAAYY,eAFA;AAGjBI,EAAAA,WAAW,EAAE,KAHI;AAIjBC,EAAAA,WAAW,EAAE;AAJI,CAAlB;;eAOeb,M","sourcesContent":["// Everything that Stratokit runs has access to the project configuration\n// Here we make sure the config is loaded before the entry point runs\n// * Only use require() so that Webpack can track dependencies, don't read files\n\nconst confippet = require('electrode-confippet')\n\n// TODO +key merges arrays\nconst mergeWith = require('lodash/mergeWith')\n\nconst {NODE_ENV} = process.env || 'development'\n\nrequire('../transpile/register-yaml')\nconst defaults = require('./defaults/default')\ntry {\n\tmergeWith(defaults, require(`./defaults/${NODE_ENV}`))\n} catch (err) {\n\tif (err.code !== 'MODULE_NOT_FOUND') {\n\t\tthrow err\n\t}\n}\n\n// Load user config with Stratokit defaults\nconst config = confippet.store()\nconfig._$.defaults(defaults)\n\n// This is code from confippet because it did too much\nconst dirs = []\nfor (let i = 0, dir = ''; (dir = process.env[`NODE_CONFIG_DIR_${i}`]); ++i) {\n\tdirs.push(dir)\n}\nif (dirs.length > 0 && process.env.NODE_CONFIG_DIR) {\n\tdirs.push(process.env.NODE_CONFIG_DIR)\n}\nif (dirs.length > 0) {\n\t// eslint-disable-next-line no-console\n\tconsole.log('config dirs', dirs)\n}\n\n// TODO while setting defaults, for all objects targets make sure the config is not `null`\n// (prevent yaml empty object overwriting defaults)\nconfig._$.compose({\n\tdirs: dirs.length > 0 && dirs,\n\tdir: process.env.NODE_CONFIG_DIR,\n\tfailMissing: false,\n\twarnMissing: true,\n})\n\nexport default config\n"],"file":"index.js"}